<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9 http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">

    <!-- Changeset # 97, 98 and 99 should be removed from realease 5.1 -->

    <changeSet id="97" author="Chethan, Mihir" runOnChange="false" context="bahmni">
        <insert schemaName="clinlims" tableName="quartz_cron_scheduler">
            <column name="id" valueNumeric=" nextval( 'quartz_cron_scheduler_seq' ) "/>
            <column name="active" type="boolean" valueBoolean="true"/>
            <column name="name" value="atom-feed-openmrs-lab"/>
            <column name="job_name" value="atom-feed-openmrs-lab"/>
            <column name="display_key" value="schedule.name.atomFeedOpenMRSLab"/>
            <column name="description_key" value="schedule.name.atomFeedOpenMRSLab"/>
            <column name="cron_statement" value="0/5 * * * * ?"/>
        </insert>
        <insert schemaName="clinlims" tableName="quartz_cron_scheduler">
            <column name="id" valueNumeric=" nextval( 'quartz_cron_scheduler_seq' ) "/>
            <column name="active" type="boolean" valueBoolean="true"/>
            <column name="name" value="atom-feed-openmrs-lab-failed"/>
            <column name="job_name" value="atom-feed-openmrs-lab-failed"/>
            <column name="display_key" value="schedule.name.atomFeedOpenMRSLab.failed"/>
            <column name="description_key" value="schedule.name.atomFeedOpenMRSLab.failed"/>
            <column name="cron_statement" value="0 0/1 * * * ?"/>
        </insert>
    </changeSet>
    <changeSet id="98" author="Mihir" context="bahmni">
        <preConditions onFail="CONTINUE">
            <sqlCheck expectedResult="2">
                select count(*) from quartz_cron_scheduler where name in
                 ('atom-feed-openmrs-lab', 'atom-feed-openmrs-lab-failed');
            </sqlCheck>
        </preConditions>
        <comment>Update cron_statement to correct cron schedule</comment>
        <sql>
            update quartz_cron_scheduler set cron_statement='0/15 * * * * ?' where name='atom-feed-openmrs-lab';
            update quartz_cron_scheduler set cron_statement='0/15 * * * * ?' where
            name='atom-feed-openmrs-lab-failed';
        </sql>
    </changeSet>
    <changeSet id="99" author="Mihir" context="bahmni">
        <preConditions onFail="CONTINUE">
            <sqlCheck expectedResult="2">
                select count(*) from quartz_cron_scheduler where name in
                 ('atom-feed-referencedata', 'atom-feed-referencedata-failed');
            </sqlCheck>
        </preConditions>
        <comment>Delete reference data atom feed scheduler</comment>
        <sql>
            delete from quartz_cron_scheduler where name='atom-feed-referencedata';
            delete from quartz_cron_scheduler where name='atom-feed-referencedata-failed';
        </sql>
    </changeSet>

</databaseChangeLog>
